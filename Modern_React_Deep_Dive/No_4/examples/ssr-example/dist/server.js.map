{"version":3,"file":"server.js","mappings":"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","sources":["webpack://ssr-example/./public/index-end.html","webpack://ssr-example/./public/index-front.html","webpack://ssr-example/./public/index.html","webpack://ssr-example/./src/components/App.tsx","webpack://ssr-example/./src/components/Todo.tsx","webpack://ssr-example/./src/fetch/index.ts","webpack://ssr-example/./src/server.ts","webpack://ssr-example/external commonjs \"isomorphic-fetch\"","webpack://ssr-example/external commonjs \"react\"","webpack://ssr-example/external commonjs \"react-dom/server\"","webpack://ssr-example/external node-commonjs \"fs\"","webpack://ssr-example/external node-commonjs \"http\"","webpack://ssr-example/webpack/bootstrap","webpack://ssr-example/webpack/runtime/define property getters","webpack://ssr-example/webpack/runtime/hasOwnProperty shorthand","webpack://ssr-example/webpack/runtime/make namespace object","webpack://ssr-example/webpack/startup"],"sourcesContent":["export default \"<script src=\\\"https://unpkg.com/react@17.0.2/umd/react.development.js\\\"></script>\\r\\n<script src=\\\"https://unpkg.com/react-dom@17.0.2/umd/react-dom.development.js\\\"></script>\\r\\n<script src=\\\"/browser.js\\\"></script>\\r\\n</body>\\r\\n</html>\";","export default \"<!DOCTYPE html>\\r\\n<html>\\r\\n  <head>\\r\\n    <meta charset=\\\"utf-8\\\" />\\r\\n    <meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0\\\" />\\r\\n    <title>SSR Example</title>\\r\\n  </head>\\r\\n  <body>\\r\\n\\r\\n\";","export default \"<!DOCTYPE html>\\r\\n<html>\\r\\n  <head>\\r\\n    <meta charset=\\\"utf-8\\\" />\\r\\n    <meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0\\\" />\\r\\n    <title>SSR Example</title>\\r\\n  </head>\\r\\n  <body>\\r\\n    __placeholder__\\r\\n    <script src=\\\"https://unpkg.com/react@17.0.2/umd/react.development.js\\\"></script>\\r\\n    <script src=\\\"https://unpkg.com/react-dom@17.0.2/umd/react-dom.development.js\\\"></script>\\r\\n    <script src=\\\"/browser.js\\\"></script>\\r\\n  </body>\\r\\n</html>\\r\\n\";","import React, { useEffect } from 'react'\r\n\r\nimport { TodoResponse } from '../fetch'\r\n\r\nimport { Todo } from './Todo'\r\n\r\nexport default function App({ todos }: { todos: Array<TodoResponse> }) {\r\n  useEffect(() => {\r\n    console.log('하이!') // eslint-disable-line no-console\r\n  }, [])\r\n\r\n  return (\r\n    <>\r\n      <h1>나의 할일!</h1>\r\n      <ul>\r\n        {todos.map((todo, index) => (\r\n          <Todo key={index} todo={todo} />\r\n        ))}\r\n      </ul>\r\n    </>\r\n  )\r\n}\r\n","import React, { useState } from 'react'\r\n\r\nimport { TodoResponse } from '../fetch'\r\n\r\nexport function Todo({ todo }: { todo: TodoResponse }) {\r\n  const { title, completed, userId, id } = todo\r\n  const [finished, setFinished] = useState(completed)\r\n\r\n  function handleClick() {\r\n    setFinished((prev) => !prev)\r\n  }\r\n\r\n  return (\r\n    <li>\r\n      <span>\r\n        {userId}-{id}) {title} {finished ? '완료' : '미완료'}\r\n        <button onClick={handleClick}>토글</button>\r\n      </span>\r\n    </li>\r\n  )\r\n}\r\n","import fetch from 'isomorphic-fetch'\r\n\r\nexport interface TodoResponse {\r\n  userId: number\r\n  id: number\r\n  title: string\r\n  completed: boolean\r\n}\r\n\r\nexport async function fetchTodo() {\r\n  const response = await fetch('https://jsonplaceholder.typicode.com/todos')\r\n  const result: TodoResponse[] = await response.json()\r\n  return result\r\n  // 스트림의 극단적인 예제를 보고 싶다면 주석 해제\r\n  // return Array(10).fill(result).flat()\r\n}\r\n","import { createServer, IncomingMessage, ServerResponse } from 'http'\r\nimport { createReadStream } from 'fs'\r\n\r\nimport { renderToNodeStream, renderToString } from 'react-dom/server'\r\nimport { createElement } from 'react'\r\n\r\nimport html from '../public/index.html'\r\nimport indexFront from '../public/index-front.html'\r\nimport indexEnd from '../public/index-end.html'\r\n\r\nimport App from './components/App'\r\nimport { fetchTodo } from './fetch'\r\n\r\nconst PORT = process.env.PORT || 3000\r\n\r\nasync function serverHandler(req: IncomingMessage, res: ServerResponse) {\r\n  const { url } = req\r\n\r\n  switch (url) {\r\n    case '/': {\r\n      const result = await fetchTodo()\r\n\r\n      const rootElement = createElement(\r\n        'div',\r\n        { id: 'root' },\r\n        createElement(App, { todos: result }),\r\n      )\r\n      const renderResult = renderToString(rootElement)\r\n\r\n      const htmlResult = html.replace('__placeholder__', renderResult)\r\n\r\n      res.setHeader('Content-Type', 'text/html')\r\n      res.write(htmlResult)\r\n      res.end()\r\n      return\r\n    }\r\n\r\n    case '/stream': {\r\n      res.setHeader('Content-Type', 'text/html')\r\n      res.write(indexFront)\r\n\r\n      const result = await fetchTodo()\r\n      const rootElement = createElement(\r\n        'div',\r\n        { id: 'root' },\r\n        createElement(App, { todos: result }),\r\n      )\r\n\r\n      const stream = renderToNodeStream(rootElement)\r\n      stream.pipe(res, { end: false })\r\n      stream.on('end', () => {\r\n        res.write(indexEnd)\r\n        res.end()\r\n      })\r\n      return\r\n    }\r\n\r\n    case '/browser.js': {\r\n      res.setHeader('Content-Type', 'application/javascript')\r\n      createReadStream(`./dist/browser.js`).pipe(res)\r\n      return\r\n    }\r\n\r\n    case '/browser.js.map': {\r\n      res.setHeader('Content-Type', 'application/javascript')\r\n      createReadStream(`./dist/browser.js.map`).pipe(res)\r\n      return\r\n    }\r\n\r\n    default: {\r\n      res.statusCode = 404\r\n      res.end('404 Not Found')\r\n    }\r\n  }\r\n}\r\n\r\nfunction main() {\r\n  createServer(serverHandler).listen(PORT, () => {\r\n    console.log(`Server has been started ${PORT}...`) // eslint-disable-line no-console\r\n  })\r\n}\r\n\r\nmain()\r\n","module.exports = require(\"isomorphic-fetch\");","module.exports = require(\"react\");","module.exports = require(\"react-dom/server\");","module.exports = require(\"fs\");","module.exports = require(\"http\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(728);\n"],"names":["todos","useEffect","console","log","map","todo","index","Todo","key","title","completed","userId","id","finished","setFinished","useState","onClick","prev","async","response","json","PORT","process","env","createServer","req","res","url","result","fetchTodo","rootElement","createElement","renderResult","renderToString","htmlResult","replace","setHeader","write","end","stream","renderToNodeStream","pipe","on","createReadStream","statusCode","listen","module","exports","require","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","call","d","definition","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","r","Symbol","toStringTag","value"],"sourceRoot":""}